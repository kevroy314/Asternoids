<!DOCTYPE html>
<html>
	<head>
		<title>Asternoids</title>
		<script src="createjs-2013.12.12.min.js"></script>
		<script type="text/javascript">
			var keyStates;
			var stage;
			var queue;
			var ball;
			var player;
			
			function init()
			{
				stage = new createjs.Stage("gameCanvas");
				
				ball = new createjs.Shape();
				ball.addEventListener("click",handleClick);
				ball.color = "#000000";
				ball.graphics.beginFill(ball.color).drawCircle(0,0,50);
				ball.color = "#000000";
				ball.counter = -1;
				ball.x = 50;
				ball.y = 200;
				stage.addChild(ball);
				
				player = new createjs.Shape();
				player.graphics.moveTo(0,0).beginFill("#00FF00").lineTo(0,-10).lineTo(30,0).lineTo(0,10).lineTo(0,0).endFill();
				player.x = 100;
				player.y = 100;
				stage.addChild(player);
				
				queue = new createjs.LoadQueue(false);
				queue.installPlugin(createjs.Sound);
				queue.addEventListener("complete",loadCompleted);
				queue.loadManifest([{id:"target", src:"assets/Target.png"},{id:"pop",src:"assets/pop.mp3"}]);
				
				createjs.Tween.get(ball,{loop:true}).to({x:450},3000).to({x:50},3000);
				createjs.Ticker.addEventListener("tick", tick);
				
				keyStates = new Array(512);
				this.document.onkeydown = keyDown;
				this.document.onkeyup = keyUp;
			}
			
			function keyDown(e)
			{
				keyStates[e.keyCode] = true;
			}
			
			function keyUp(e)
			{
				keyStates[e.keyCode] = false;
			}
			
			function loadCompleted()
			{
				
			}
			
			function handleClick(event)
			{
				ball.counter = 10;
				createjs.Sound.play("pop");
			}
			
			function tick(event)
			{
				if(ball.counter>0)
				{
					ball.graphics.beginFill("#FF0000").drawCircle(0,0,50);
					ball.counter--;
				}
				if(ball.counter == 0)
				{
					ball.graphics.beginFill(ball.color).drawCircle(0,0,50);
					ball.counter--;
				}
				if(keyStates[87]) //w
					player.y--;
				if(keyStates[65]) //a
					player.x--;
				if(keyStates[83]) //s
					player.y++;
				if(keyStates[68]) //d
					player.x++;
				stage.update();
			}
		</script>
	</head>
	<body onload="init()">
		<canvas id="gameCanvas" width="500" height="500">HTML5 is not supported by your browser.</canvas>
	</body>
</html>